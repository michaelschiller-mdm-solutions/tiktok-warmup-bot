# [4-3] Create `account_setup.js` API script

## Description
This task is to create a Node.js script at `scripts/api/account_setup.js` that serves as the main entry point for the frontend to trigger the automated account setup process. This script will parse command-line arguments, instantiate the necessary services (`AutomationBridge`, `EmailTokenFetcher`, `AccountSetupService`), and invoke the setup process.

[Back to task list](./tasks.md)

## Status History
| Timestamp           | Event Type | From Status | To Status | Details           | User |
| ------------------- | ---------- | ----------- | --------- | ----------------- | ---- |
| 2024-07-22 10:02:00 | Created    | N/A         | Proposed  | Task file created | AI   |

## Requirements
- The script must be created at `scripts/api/account_setup.js`.
- It must be runnable from the command line: `node scripts/api/account_setup.js <setup_config_json>`.
- The `<setup_config_json>` argument will be a JSON string containing all necessary data (`containerNumber`, `username`, `password`, `emailConfig`).
- The script should handle parsing the JSON string safely.
- It must instantiate `AutomationBridge`, `EmailTokenFetcher`, and `AccountSetupService`.
- It must call the `accountSetupService.run(config)` method.
- It should log the final outcome (success or failure) to the console in a machine-readable format (e.g., JSON).

## Implementation Plan
1.  **Create File**: `scripts/api/account_setup.js`.
2.  **Import Dependencies**:
    - `require('../../services/AutomationBridge')`
    - `require('../../services/EmailTokenFetcher')`
    - `require('../../services/AccountSetupService')`
3.  **Argument Parsing**:
    - In an `async function main()`, read `process.argv[2]`.
    - Use a `try...catch` block to `JSON.parse` the argument. If it fails, print a usage error and exit.
4.  **Service Instantiation**:
    - `const bridge = new AutomationBridge();`
    - `const fetcher = new EmailTokenFetcher();`
    - `const setupService = new AccountSetupService(bridge, fetcher);`
5.  **Execution**:
    - Call `await setupService.run(parsedConfig)`.
    - Wrap this call in `try...catch`.
6.  **Output**:
    - On success, `console.log(JSON.stringify({ success: true, message: 'Account setup completed.' }))`.
    - On failure, `console.log(JSON.stringify({ success: false, error: error.message }))`.
7.  **CLI Execution Block**:
    ```javascript
    if (require.main === module) {
        main().catch(console.error);
    }
    ```

## Verification
- The script is created at the correct path.
- It correctly parses a JSON string from the command line.
- It successfully instantiates and calls the `AccountSetupService`.
- It prints a JSON object indicating success or failure to stdout.

## Files Modified
- `scripts/api/account_setup.js` (created) 