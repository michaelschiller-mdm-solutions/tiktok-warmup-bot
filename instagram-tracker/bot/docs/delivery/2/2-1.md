# [2-1] Create C source for `crane-cli` tool

## Description
Based on the user's research, this task is to create the C source code for the command-line tool that will be used to switch Crane containers. The tool will communicate with `cranehelperd` via XPC.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|---|---|---|---|---|---|
| 2024-07-25 10:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements
- The C file should be named `main.c`.
- It must be placed in a new directory: `scripts/iphone_tool/crane-cli/`.
- It must implement the XPC communication logic as outlined in the research.
- It must take the `bundleID` and `containerID` as command-line arguments.
- It should include basic error handling and logging to `stdout`/`stderr`.
- The code must be self-contained and not rely on `libCrane.h` to minimize dependencies.

## Implementation Plan
1. Create the directory `scripts/iphone_tool/crane-cli/`.
2. Create the file `main.c` inside this new directory.
3. Write the C code based on the provided XPC snippet.
   - Include necessary headers: `<xpc/xpc.h>`, `<dispatch/dispatch.h>`, `<stdio.h>`, `<stdlib.h>`.
   - Define the Mach service name: `com.opa334.cranehelperd.xpc`.
   - The `main` function will parse `argc` and `argv` for the bundle ID and container ID.
   - A function `activateContainer` will handle the XPC communication.
   - The XPC message will be a dictionary with keys: `action`, `bundleID`, `containerID`. The value for `action` will be `activateContainer`.
   - The tool will wait for a reply and print the status.
   - A dispatch semaphore will be used to wait for the asynchronous reply to prevent the tool from exiting prematurely.

## Verification
- The code must compile without errors using Theos.
- The compiled tool, when run, must successfully switch the container.

## Files Modified
- `scripts/iphone_tool/crane-cli/main.c` (new file)

[Back to task list](./tasks.md) 