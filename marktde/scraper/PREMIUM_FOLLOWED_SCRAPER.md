# Premium Followed Accounts Scraper

This scraper extracts premium accounts from the "mir gefallen" (liked by me) section for each target account in your `target_accounts.csv` file.

**Note**: All scraper files are now organized in the `marktde/scraper/` folder for better organization.

## What it does

For each target account:
1. Navigates to their profile page
2. Opens the "mir gefallen" modal (accounts they follow)
3. Extracts all premium accounts (identified by `clsy-profile-image--premium` class)
4. If no premium accounts are found, extracts 5 normal accounts and marks them as `premium: false`
5. Saves results to `premium_followed_by.csv`

## Prerequisites

1. Make sure you have target accounts in `target_accounts.csv` (generated by the main scraper)
2. Install dependencies:
   ```bash
   npm install playwright
   npx playwright install chromium
   ```

## Usage

Navigate to the scraper folder first:
```bash
cd marktde/scraper
node premium-followed-scraper.js
```

## Output Format

The scraper creates `premium_followed_by.csv` with these columns:

| Column | Description |
|--------|-------------|
| `target_account` | Name of the target account |
| `target_account_id` | User ID of the target account |
| `followed_account` | Name of the account they follow |
| `followed_account_id` | User ID of the followed account |
| `is_premium` | `true` for premium accounts, `false` for fallback normal accounts |
| `profile_image_url` | URL of the followed account's profile image |
| `profile_link` | Link to the followed account's profile |

## Special Cases Handled

1. **No "mir gefallen" button**: If a target account doesn't follow anyone, saves record with `NO_FOLLOWS`
2. **No accounts found**: If modal is empty, saves record with `NO_ACCOUNTS_FOUND`  
3. **No premium accounts**: If no premium accounts exist, extracts 5 normal accounts marked as `premium: false`
4. **Duplicates**: Automatically prevents duplicate target+followed account pairs

## Configuration

You can modify these settings in the `CONFIG` object:

```javascript
const CONFIG = {
    limits: {
        maxPremiumAccounts: 50,      // Max premium accounts per target
        fallbackNormalAccounts: 5,   // Normal accounts if no premium found
        maxLoadMoreClicks: 100       // Safety limit for pagination
    },
    
    delays: {
        pageLoad: 3000,              // Wait for page load
        modalLoad: 2000,             // Wait for modal open
        loadMore: 1200,              // Wait between pagination clicks
        betweenProfiles: 2000        // Wait between target accounts
    },
    
    browser: {
        headless: false,             // Set to true for background mode
        slowMo: 500                  // Slow down for visibility
    }
};
```

## Premium Account Detection

Premium accounts are identified by the CSS class structure:
```html
<div class="clsy-profile-image clsy-profile-image--small clsy-profile-image--premium">
    <img src="profile-image-url" class="clsy-profile-image__image" alt="Profil">
    <span class="clsy-visually-hidden">Premium</span>
</div>
```

The scraper looks for the `clsy-profile-image--premium` class to identify premium accounts.

## Error Handling

- Continues processing other accounts if one fails
- Logs all errors with target account names
- Saves progress incrementally (every 10 accounts)
- Handles cookie consent automatically
- Manages modal loading and pagination errors

## Example Output

```csv
target_account,target_account_id,followed_account,followed_account_id,is_premium,profile_image_url,profile_link
"John Doe",12345,"Premium User",67890,true,"https://imagecache.markt.de/abc123/image","/premium-user/userId,67890/profile.htm"
"John Doe",12345,"Normal User",11111,false,"https://imagecache.markt.de/def456/image","/normal-user/userId,11111/profile.htm"
```

## Troubleshooting

1. **No target accounts found**: Make sure `target_accounts.csv` exists and has the correct format
2. **Modal won't open**: Some accounts may have privacy settings preventing access to their follows
3. **Slow performance**: Increase delays in CONFIG if the site is slow to load
4. **Browser crashes**: Reduce `slowMo` or set `headless: true` for better performance

## Integration with Main Scraper

This scraper is designed to work with the output of `markt-de-scraper-automated.js`:

1. First run: `node markt-de-scraper-automated.js` to get target accounts
2. Then run: `node premium-followed-scraper.js` to get premium followed accounts
3. Use the `premium_followed_by.csv` for your messaging campaigns